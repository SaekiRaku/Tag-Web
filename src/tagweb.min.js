/** HTML5 canvas tag web
 *  @Author ThomasSoloist
 *  @Date 2015/12/28
 *  Released under the MIT license
 */

function TagWeb(b,e,i){this.canvas=undefined;var k;var m;var g;var e=new Array();var j=300;var f="rgba(255,255,255,0.26)";var d="#FFFFFF";var a="微软雅黑";if(arguments.length!=0){l(b,e,i)}setInterval(h,10);this.init=function(n){l(n,myData,myStrokeStyle)};this.setLineStyle=function(n){if(n==undefined||typeof n!="string"||typeof n!="object"){throw new Error("wrong type of strokeStyle");return}f=n};this.setTextStyle=function(n){if(n==undefined||typeof n!="string"||typeof n!="object"){throw new Error("wrong type of strokeStyle");return}d=n};this.setTextFont=function(n){if(n==undefined||typeof n!="string"){throw new Error("wrong type of fontName");return}a=n};this.setLineRange=function(n){j=n};this.addTag=function(r,q,n,s){if(r==undefined||typeof r!="string"){throw new Error("wrong type of str");return}else{if(q==undefined){q=48*Math.random()+12}}if(typeof q!="number"){throw new Error("wrong type of fontSize");return}var o=canvas.offsetWidth*0.8;var p=canvas.offsetHeight*0.8;m.font=obj.fontSize+"px "+a;e.push({x:o*0.1+Math.random()*(o-m.measureText(r).width)+m.measureText(r).width,y:p*0.1+Math.random()*(p-q)+q,xmove:Math.random()*20,xrandom:Math.random()*0.5,ymove:Math.random()*20,yrandom:Math.random()*0.5,tag:r,fontSize:q})};this.gridHypodispersion=function(w,r){var o=0;var v=canvas.offsetWidth*0.8;var u=canvas.offsetHeight*0.8;var t=v/r;var p=u/w;for(var s=0;s<w;s++){for(var q=0;q<r;q++){if(o>=e.length){break}else{e[o].x=v*0.1+t*s+(t*Math.random());e[o].y=u*0.1+p*q+(p*Math.random());o++}}}};this.addCallBack=function(n){k=n};function l(n){if(n==undefined||c(n)==""){throw new Error("divID must be given");return false}var o=document.createElement("canvas");canvas=document.getElementById(n).appendChild(o);canvas.width=document.getElementById(n).offsetWidth;canvas.height=document.getElementById(n).offsetHeight;m=canvas.getContext("2d");m.textAlign="center";canvas.addEventListener("mousemove",function(r){for(var s=0;s<e.length;s++){var t=e[s];m.font=t.fontSize+"px "+a;var q=(r.offsetX>t.x+t.xmove-m.measureText(t.tag).width/2);var p=(r.offsetX<t.x+t.xmove+m.measureText(t.tag).width/2);var v=(r.offsetY>t.y+t.ymove-t.fontSize);var u=(r.offsetY<t.y+t.ymove);if(q&&p&&v&&u){canvas.style.cursor="pointer";g=t.tag;break}else{canvas.style.cursor="default";g=null}}});canvas.addEventListener("click",function(){if(g!=null&&k!=undefined){k(g)}})}function h(){m.clearRect(0,0,canvas.offsetWidth,canvas.offsetHeight);var q;for(var o=0;o<e.length;o++){q=e[o];q.xmove+=Math.sin(Date.now()*q.xrandom*Math.PI/180)/5;q.ymove+=Math.cos(Date.now()*q.yrandom*Math.PI/180)/5;m.fillStyle=d;m.font=q.fontSize+"px "+a;m.fillText(q.tag,q.x+q.xmove,q.y+q.ymove);m.strokeStyle=f;m.beginPath();for(var n=0;n<e.length;n++){var p=Math.sqrt(Math.pow((q.x+q.xmove)-(e[n].x+e[n].xmove),2)+Math.pow((q.y+q.ymove)-(e[n].y+e[n].ymove),2));if(p<j){m.moveTo(q.x+q.xmove,q.y+q.ymove);m.lineTo(e[n].x+e[n].xmove,e[n].y+e[n].ymove)}}m.stroke()}}function c(n){return n.replace(/(^\s*)|(\s*$)/g,"")}};